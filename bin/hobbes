#! /usr/bin/env node

global.sys = require(/^v0\.[012]/.test(process.version) ? "sys" : "util");
var fs = require("fs");
var hobbes = require("../hobbes");

var filename = process.argv[2];

if (filename) {
  fs.readFile(filename, "utf8", function(err, src){
    if (err) throw err;
    execute(src);

    process.exit();
  });
}

function execute(src) {
  try {
    hobbes.compiler.run(src);
  } catch (err) {
    if (err.type === 'CompileTimeError') {
      process.stdout.write(filename + ':' + err.line + ': ' + err.message + '\n' + err.description + '\n1 error\n');
    } else {
      process.stdout.write(filename + '\n');
      throw err;
    }
  }
};

